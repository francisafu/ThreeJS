<!DOCTYPE html>

<html lang="en">

<head>
    <title>OBJLoader Test</title>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, user-scalable=no, minimum-scale=1.0, maximum-scale=1.0">
    <script type="text/javascript" src="../three.js-master/build/three.js"></script>
    <script type="text/javascript" src="../dat.gui.js"></script>
    <script type="text/javascript" src="http://apps.bdimg.com/libs/jquery/2.1.4/jquery.js"></script>
    <script src="../three.js-master/examples/js/loaders/OBJLoader.js"></script>
    <style>
        #WebGL-output {
            width: 300px;
            height: 400px;
            border: 1px solid black;
            margin: 100px;
            padding: 0px;
            position: static; /* fixed or static */
            top: 100px;
            left: 100px;
        }
    </style>
</head>
<body>

<!-- Div which will hold the Output -->
<div id="WebGL-output"></div>

<!-- Javascript code that runs our Three.js examples -->
<script type="text/javascript">

    // once everything is loaded, we run our Three.js stuff.
    function init() {
        // here we'll put the Three.js stuff
        var divWidth = 300;
        var divHeight = 400;
        var container = document.getElementById('WebGL-output');
        var scene = new THREE.Scene();
        var camera = new THREE.PerspectiveCamera(45, divWidth / divHeight, 0.1, 1000);
        var renderer = new THREE.WebGLRenderer();
        renderer.setSize(divWidth, divHeight);
        renderer.setClearColor(0xEEEEEE, 1.0);
        renderer.shadowMap.enabled = true;

        var planeGeometry = new THREE.PlaneGeometry(50, 30);
        var planeMaterial = new THREE.MeshLambertMaterial({color: 0xffffff});
        var planeH = new THREE.Mesh(planeGeometry, planeMaterial);
        planeH.rotation.x = -0.5 * Math.PI;
        planeH.position.x = 0;
        planeH.position.y = 0;
        planeH.position.z = planeH.geometry.parameters.height / 2;
        planeH.receiveShadow = true;
        //scene.add(planeH);

        var planeV = new THREE.Mesh(planeGeometry, planeMaterial);
        planeV.rotation.x = 0;
        planeV.position.x = 0;
        planeV.position.y = planeV.geometry.parameters.height / 2;
        planeV.position.z = 0;
        planeV.receiveShadow = true;
        //scene.add(planeV);

        var spotLight = new THREE.SpotLight(0xffffff);
        spotLight.position.set(0, 30, 30);
        spotLight.castShadow = true;
        spotLight.shadow.bias = 0.0001;
        spotLight.shadow.mapSize.width = 2048;
        spotLight.shadow.mapSize.height = 2048;
        spotLight.intensity = 0.9;


        // instantiate a loader
        var loader = new THREE.OBJLoader();

        // load a resource
        loader.load(
            // resource URL
            '../model/Sofa.OBJ',
            // called when resource is loaded
            function ( object ) {
                object.position.x=0;
                object.traverse(function (child) {
                    if (child instanceof THREE.Mesh) {
                        child.material.color = 0xffb830;
                    }
                });
                object.material=planeMaterial;
                scene.add( object );
                spotLight.target = object;
                scene.add(spotLight);
                console.log(object);

            },
            // called when loading is in progresses
            function ( xhr ) {

                //console.log( ( xhr.loaded / xhr.total * 100 ) + '% loaded' );

            },
            // called when loading has errors
            function ( error ) {

                console.log( 'An error happened' );

            }
        );


        var axes = new THREE.AxesHelper(30);
        scene.add(axes);



        var ambientLight = new THREE.AmbientLight(0xd3d3d3, 0.4);
        scene.add(ambientLight);
        camera.position.x = 100;
        camera.position.y = 100;
        camera.position.z = 100;
        camera.lookAt(scene.position);
        renderer.render(scene, camera);
        container.appendChild(renderer.domElement);
    }

    window.onload = init

</script>
</body>
</html>